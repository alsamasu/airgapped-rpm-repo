# config/spec.yaml
# Airgapped RPM Repository System - Satellite + Capsule Architecture
#
# This file is the SINGLE SOURCE OF TRUTH for all deployment inputs.
# Architecture: External Satellite (connected) + Internal Capsule (disconnected)
#
# Usage:
#   1. Copy this file and fill in your environment-specific values
#   2. Run: .\scripts\operator.ps1 validate-spec
#   3. Run: .\scripts\operator.ps1 deploy-servers
#
# All sensitive values (passwords) should be changed after initial deployment.

# =============================================================================
# VMware vCenter/ESXi Connection
# =============================================================================
vcenter:
  # vCenter or ESXi host address (IP or FQDN)
  server: "vcenter.example.local"

  # Datacenter name (required for vCenter; ignored for ESXi direct connection)
  datacenter: "Datacenter"

  # Cluster name OR specific ESXi host
  cluster: "Cluster01"
  # host: "esxi01.example.local"  # Alternative: direct ESXi host

  # Datastore for VM storage
  datastore: "datastore1"

  # Optional: VM folder path
  folder: ""

  # Optional: Resource pool name
  resource_pool: ""

# =============================================================================
# Network Configuration
# =============================================================================
network:
  # Port group name for VM network adapters
  portgroup_name: "LAN"

  # Network uses DHCP
  dhcp: true

  # DNS servers (required for Satellite)
  dns_servers:
    - "8.8.8.8"
    - "8.8.4.4"

  # DNS search domain
  dns_search: "example.local"

# =============================================================================
# ISO Paths
# =============================================================================
isos:
  # Path to RHEL 9.6 ISO (Satellite and Capsule require RHEL 9)
  rhel96_iso_path: "/isos/rhel-9.6-x86_64-dvd.iso"

  # Datastore folder for ISOs
  iso_datastore_folder: "isos"

# =============================================================================
# VM Names and Sizing
# =============================================================================
vm_names:
  # External Satellite server (internet-connected)
  satellite: "satellite-external"

  # Internal Capsule server (airgapped)
  capsule: "capsule-internal"

# Satellite/Capsule require significant resources
# Reference: https://access.redhat.com/documentation/en-us/red_hat_satellite
vm_sizing:
  satellite:
    cpu: 4                # Minimum 4 cores
    memory_gb: 20         # Minimum 20 GB RAM
    disk_os_gb: 50        # OS partition
    disk_pulp_gb: 500     # /var/lib/pulp for content storage
    disk_pgsql_gb: 50     # PostgreSQL data
  capsule:
    cpu: 4                # Minimum 4 cores
    memory_gb: 16         # Minimum 16 GB RAM
    disk_os_gb: 50        # OS partition
    disk_pulp_gb: 300     # Content cache

# =============================================================================
# Bootstrap Credentials
# =============================================================================
credentials:
  # Root password for initial access
  initial_root_password: "ChangeMe123!"

  # Admin user for day-to-day operations
  initial_admin_user: "admin"
  initial_admin_password: "ChangeMe123!"

  # Satellite admin credentials
  satellite_admin_user: "admin"
  satellite_admin_password: "SatelliteAdmin123!"

# =============================================================================
# Red Hat Subscription
# =============================================================================
# Required for Satellite and Capsule installation
subscription:
  # Red Hat Subscription Manager credentials
  # Use rhsm_activation_key + rhsm_org_id OR rhsm_username + rhsm_password
  rhsm_activation_key: ""
  rhsm_org_id: ""
  # Alternative: username/password (less secure)
  # rhsm_username: ""
  # rhsm_password: ""

  # Satellite manifest file path (required for Satellite)
  # Download from https://access.redhat.com/management/subscription_allocations
  manifest_path: "/path/to/satellite-manifest.zip"

  # Pool IDs for Satellite subscription (auto-attached if empty)
  satellite_pool_id: ""

# =============================================================================
# Satellite Organization Configuration
# =============================================================================
satellite:
  # Organization name (created during setup)
  organization: "Default Organization"

  # Location name (created during setup)
  location: "Default Location"

  # Lifecycle environments (order matters: Library -> test -> prod)
  lifecycle_environments:
    - name: "test"
      description: "Testing environment for validation"
      prior: "Library"
    - name: "prod"
      description: "Production environment for managed hosts"
      prior: "test"

  # Default lifecycle environment for new hosts
  default_lifecycle_env: "prod"

# =============================================================================
# Content Configuration
# =============================================================================
content:
  # RHEL 8 repository configuration
  rhel8:
    # Product name in Satellite
    product: "Red Hat Enterprise Linux for x86_64"
    # Repository sets to enable
    repository_sets:
      - name: "Red Hat Enterprise Linux 8 for x86_64 - BaseOS (RPMs)"
        releasever: "8.10"
        basearch: "x86_64"
      - name: "Red Hat Enterprise Linux 8 for x86_64 - AppStream (RPMs)"
        releasever: "8.10"
        basearch: "x86_64"

  # RHEL 9 repository configuration
  rhel9:
    product: "Red Hat Enterprise Linux for x86_64"
    repository_sets:
      - name: "Red Hat Enterprise Linux 9 for x86_64 - BaseOS (RPMs)"
        releasever: "9.6"
        basearch: "x86_64"
      - name: "Red Hat Enterprise Linux 9 for x86_64 - AppStream (RPMs)"
        releasever: "9.6"
        basearch: "x86_64"

# =============================================================================
# Content Views
# =============================================================================
content_views:
  # RHEL 8 Security Content View
  - name: "cv_rhel8_security"
    description: "RHEL 8 Security Updates Only"
    repositories:
      - product: "Red Hat Enterprise Linux for x86_64"
        name: "Red Hat Enterprise Linux 8 for x86_64 - BaseOS RPMs 8.10"
      - product: "Red Hat Enterprise Linux for x86_64"
        name: "Red Hat Enterprise Linux 8 for x86_64 - AppStream RPMs 8.10"
    filters:
      - name: "security_errata_only"
        type: "erratum"
        inclusion: true
        errata_type: "security"
        # Date range (optional - leave empty for all security errata)
        date_start: ""
        date_end: ""

  # RHEL 9 Security Content View
  - name: "cv_rhel9_security"
    description: "RHEL 9 Security Updates Only"
    repositories:
      - product: "Red Hat Enterprise Linux for x86_64"
        name: "Red Hat Enterprise Linux 9 for x86_64 - BaseOS RPMs 9.6"
      - product: "Red Hat Enterprise Linux for x86_64"
        name: "Red Hat Enterprise Linux 9 for x86_64 - AppStream RPMs 9.6"
    filters:
      - name: "security_errata_only"
        type: "erratum"
        inclusion: true
        errata_type: "security"
        date_start: ""
        date_end: ""

# =============================================================================
# Export/Import Configuration
# =============================================================================
export:
  # Output directory for export bundles on Satellite
  output_dir: "/var/lib/pulp/exports"

  # Bundle naming pattern (timestamp appended automatically)
  bundle_prefix: "airgap-security-bundle"

  # Include metadata and checksums
  include_manifest: true
  include_checksums: true

  # Sync policy: "complete" (full) or "incremental" (delta)
  sync_policy: "complete"

import:
  # Import staging directory on Capsule
  staging_dir: "/var/lib/pulp/imports"

  # Verified bundles storage
  verified_dir: "/var/lib/pulp/verified"

# =============================================================================
# Capsule Configuration
# =============================================================================
capsule:
  # Capsule FQDN (used in certificates)
  fqdn: "capsule-internal.example.local"

  # Services to enable on Capsule
  services:
    - "content"           # Content proxy
    - "pulp"              # Pulp content service

  # HTTPS port for content
  https_port: 443

  # Enable HTTPS with server-auth TLS
  tls_enabled: true

  # Certificate configuration
  certs:
    # Self-signed for initial setup (production should use CA-signed)
    self_signed: true
    country: "US"
    state: "Virginia"
    locality: "Arlington"
    organization: "Airgap Ops"
    organizational_unit: "Infrastructure"
    validity_days: 365

# =============================================================================
# Ansible Configuration
# =============================================================================
ansible:
  # SSH credentials for managed hosts
  ssh_username: "admin"
  ssh_password: "ChangeMe123!"

  # Host inventory for patching
  host_inventory:
    rhel9_hosts:
      - hostname_or_ip: "192.168.1.117"
        airgap_host_id: "rhel9-tester"
        os_profile: "rhel9"
        content_view: "cv_rhel9_security"
        lifecycle_env: "prod"

    rhel8_hosts:
      - hostname_or_ip: "192.168.1.87"
        airgap_host_id: "rhel8-tester"
        os_profile: "rhel8"
        content_view: "cv_rhel8_security"
        lifecycle_env: "prod"

# =============================================================================
# Syslog TLS Forwarding
# =============================================================================
syslog_tls:
  target_host: "syslog.example.local"
  target_port: 6514
  ca_bundle_local_path: "/path/to/syslog-ca-bundle.crt"

# =============================================================================
# Compliance Configuration
# =============================================================================
compliance:
  # Enable FIPS mode
  enable_fips: true

  # STIG profile
  stig_profile: "xccdf_org.ssgproject.content_profile_stig"

  # Generate STIG checklist files
  generate_ckl: true

# =============================================================================
# Evidence Collection
# =============================================================================
evidence:
  # Base directory for evidence artifacts
  output_dir: "./automation/artifacts/e2e-satellite-proof"

  # Evidence subdirectories
  workflow_dir: "workflow"
  logs_dir: "logs"

  # Generate truth-table.json
  generate_truth_table: true

# =============================================================================
# Monthly Operations Schedule
# =============================================================================
schedule:
  # Day of month for sync/publish operations
  sync_day: 15

  # Patch window (day of month, hour)
  patch_window:
    day: 20
    hour: 2
    timezone: "America/New_York"

  # Auto-promote from test to prod after validation (hours)
  auto_promote_delay_hours: 24
