# httpd-repos.conf - Apache configuration for RPM repository serving
#
# Serves repositories over HTTP (8080) and HTTPS (8443) with:
# - Lifecycle environments (testing/stable)
# - GPG key distribution
# - Health check endpoint

# Alias for lifecycle environments
Alias /lifecycle /data/lifecycle
Alias /repos /data/repos
Alias /keys /data/keys

# Health check endpoint
<Location /health>
    SetHandler server-status
    Require all granted
</Location>

# Lifecycle directory (testing/stable)
<Directory "/data/lifecycle">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    
    # Enable directory indexing
    IndexOptions FancyIndexing HTMLTable VersionSort
    IndexOptions NameWidth=* DescriptionWidth=*
    
    # MIME types for repo files
    AddType application/x-rpm .rpm
    AddType application/xml .xml
    AddType application/x-gzip .gz
    AddType application/x-xz .xz
</Directory>

# Direct repos directory
<Directory "/data/repos">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    
    IndexOptions FancyIndexing HTMLTable VersionSort
    IndexOptions NameWidth=* DescriptionWidth=*
    
    AddType application/x-rpm .rpm
    AddType application/xml .xml
    AddType application/x-gzip .gz
    AddType application/x-xz .xz
</Directory>

# GPG keys directory
<Directory "/data/keys">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    
    # Force download of key files
    AddType application/pgp-keys .key
    AddType application/pgp-keys .asc
    AddType application/pgp-keys .gpg
</Directory>

# Logging configuration
ErrorLog /var/log/rpmserver/httpd-error.log
CustomLog /var/log/rpmserver/httpd-access.log combined

# Security headers
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "DENY"
Header always set Content-Security-Policy "default-src 'self'"
