# System Security Plan (SSP) - NIST SP 800-53 Controls

## Airgapped RPM Repository System

**Document Version:** 1.0  
**Last Updated:** 2024-12-30  
**Classification:** UNCLASSIFIED  

---

## 1. System Overview

### 1.1 System Name
Airgapped RPM Repository System

### 1.2 System Description
The Airgapped RPM Repository System provides secure, offline package management for RHEL-based systems in disconnected environments. The system consists of:

- **External Builder**: Internet-connected system for syncing packages from Red Hat CDN
- **Internal Publisher**: Airgapped RHEL 9.6 VM serving repositories over HTTPS
- **Ansible Automation**: Configuration management for managed hosts

### 1.3 System Boundary
- Internal RHEL 9.6 VM with rootless Podman
- Managed RHEL 8/9 hosts within the airgapped network
- Hand-carry media for bundle transfer

---

## 2. Security Controls Implementation

### 2.1 Access Control (AC)

#### AC-2 Account Management
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AC-2(1) | Automated account management via Ansible | `ansible/playbooks/bootstrap_ssh_keys.yml` |
| AC-2(3) | Inactive accounts disabled after 35 days | STIG role configuration |
| AC-2(4) | Automated audit of account actions | `/var/log/stig-evidence/audit-sample.txt` |

**Implementation Details:**
- Service user `rpmops` runs rootless Podman containers
- SSH key-based authentication for managed hosts
- No password authentication permitted (STIG requirement)

#### AC-3 Access Enforcement
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AC-3 | Role-based access via file permissions | Container volumes with :Z labels |
| AC-3(4) | Discretionary access control | Standard UNIX permissions |

#### AC-17 Remote Access
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AC-17(2) | Encrypted remote access only | SSH with Ed25519 keys |
| AC-17(4) | Privileged command restrictions | `ansible/roles/stig_base/tasks/main.yml` |

### 2.2 Audit and Accountability (AU)

#### AU-2 Audit Events
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AU-2 | Audit of security-relevant events | `ansible/roles/stig_audit/tasks/main.yml` |

**Audited Events:**
- Authentication attempts (success/failure)
- Privilege escalation (sudo, su)
- File system modifications
- System configuration changes
- Network configuration changes
- Kernel module operations

#### AU-3 Content of Audit Records
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AU-3 | Audit records include required fields | Auditd configuration |

**Audit Record Fields:**
- Timestamp (date/time)
- Event type
- Subject identity (user/process)
- Object identity (file/resource)
- Outcome (success/failure)

#### AU-6 Audit Review, Analysis, and Reporting
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AU-6(1) | Automated audit log analysis | Rsyslog forwarding to SIEM |
| AU-6(3) | Audit record correlation | Central syslog aggregation |

#### AU-9 Protection of Audit Information
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| AU-9 | Audit logs protected from modification | Immutable audit rules (`-e 2`) |
| AU-9(4) | Audit logs forwarded to remote server | TLS syslog forwarding |

**Syslog TLS Configuration:**
- Transport: TCP with TLS (port 6514)
- Authentication: Server certificate verification only
- CA Bundle Path: `/etc/pki/tls/certs/syslog-ca.crt`
- Queue: Disk-assisted for reliability

### 2.3 Configuration Management (CM)

#### CM-2 Baseline Configuration
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| CM-2 | Documented baseline configuration | Ansible playbooks and roles |
| CM-2(2) | Automation support for accuracy | `ansible/playbooks/site.yml` |

#### CM-3 Configuration Change Control
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| CM-3 | Changes tracked in Git | Git commit history |
| CM-3(2) | Testing of changes before production | E2E test suite |

#### CM-6 Configuration Settings
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| CM-6 | Security configuration settings | STIG hardening roles |

**Key Configuration Settings:**
- Password complexity: 15 chars, 4 character classes
- SSH hardening: No root password login, no X11 forwarding
- Kernel parameters: ASLR enabled, source routing disabled

#### CM-7 Least Functionality
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| CM-7 | Minimal installed packages | Container-based deployment |
| CM-7(1) | Periodic review of functions | Ansible automation |

### 2.4 Identification and Authentication (IA)

#### IA-2 Identification and Authentication
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| IA-2 | Unique user identification | SSH key pairs |
| IA-2(1) | Multi-factor authentication (where applicable) | SSH key + passphrase |
| IA-2(8) | Replay-resistant authentication | SSH protocol |

#### IA-5 Authenticator Management
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| IA-5(1) | Password complexity enforcement | `/etc/security/pwquality.conf` |
| IA-5(2) | PKI-based authentication | Ed25519 SSH keys |

### 2.5 System and Communications Protection (SC)

#### SC-8 Transmission Confidentiality and Integrity
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SC-8 | Encrypted communications | HTTPS (TLS 1.2+), SSH |
| SC-8(1) | Cryptographic protection | TLS certificates |

**HTTPS Configuration:**
- Protocol: TLS 1.2 minimum
- Certificates: Self-signed bootstrap, CA-signed for production
- Certificate Path: `/data/certs/server.crt`

#### SC-12 Cryptographic Key Establishment and Management
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SC-12 | Key management procedures | Certificate lifecycle docs |
| SC-12(1) | FIPS-validated cryptography | FIPS mode validation |

#### SC-13 Cryptographic Protection
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SC-13 | FIPS 140-2 validated algorithms | System crypto policy |

**FIPS Validation:**
- Kernel FIPS mode status: `/proc/sys/crypto/fips_enabled`
- Crypto policy: Validated via `update-crypto-policies --show`
- Evidence: `/var/log/stig-evidence/fips-validation.txt`

#### SC-23 Session Authenticity
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SC-23 | Session authentication | TLS session management |

### 2.6 System and Information Integrity (SI)

#### SI-2 Flaw Remediation
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SI-2 | Security patching process | `ansible/playbooks/patch_monthly_security.yml` |
| SI-2(2) | Automated flaw remediation | Monthly patching playbook |

**Patching Process:**
1. Security updates identified via dnf
2. Pre-patch health checks performed
3. Security-only updates applied
4. Controlled reboot orchestration
5. Post-patch validation

#### SI-3 Malicious Code Protection
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SI-3 | Package signature verification | GPG signature checking |

**Package Verification:**
- GPG key: `/etc/pki/rpm-gpg/RPM-GPG-KEY-internal`
- Signature verification: `gpgcheck=1` in repo configuration
- Repodata signatures: Verified during bundle import

#### SI-7 Software, Firmware, and Information Integrity
| Control | Implementation | Evidence Location |
|---------|---------------|-------------------|
| SI-7 | Integrity verification | BOM checksums, GPG signatures |
| SI-7(1) | Integrity checks at startup | Bundle validation |

---

## 3. Evidence Collection

### 3.1 Automated Evidence Collection
The STIG hardening playbook automatically collects evidence:

```bash
# Run STIG hardening with evidence collection
ansible-playbook playbooks/stig_harden_internal_vm.yml
```

**Evidence Location:** `/var/log/stig-evidence/`

### 3.2 Evidence Files
| File | Description |
|------|-------------|
| `hardening-timestamp.txt` | Timestamp of STIG hardening |
| `audit-sample.txt` | Sample of recent audit events |
| `rsyslog-config.txt` | Active rsyslog configuration |
| `fips-status.txt` | FIPS mode enablement status |
| `fips-validation.txt` | Detailed FIPS validation report |

### 3.3 Manual Evidence Commands
```bash
# Check audit configuration
auditctl -l

# Check SSH configuration
sshd -T | grep -E 'permitrootlogin|passwordauth'

# Check crypto policy
update-crypto-policies --show

# Check FIPS mode
cat /proc/sys/crypto/fips_enabled
```

---

## 4. Continuous Monitoring

### 4.1 Log Aggregation
All system logs are forwarded to a central syslog server over TLS:

- **Transport:** TCP with GnuTLS
- **Port:** 6514 (TLS)
- **Authentication:** Server certificate verification
- **Queue:** Disk-assisted with 1GB max

### 4.2 Configuration Variables
| Variable | Default | Description |
|----------|---------|-------------|
| `syslog_tls_target_host` | (required) | Syslog server hostname |
| `syslog_tls_target_port` | 6514 | Syslog TLS port |
| `syslog_tls_ca_bundle_path` | `/etc/pki/tls/certs/syslog-ca.crt` | CA certificate path |

### 4.3 Health Monitoring
```bash
# Check repository HTTPS status
curl -fsk https://localhost:8443/health

# Check container status
podman ps --format "{{.Names}} {{.Status}}"

# Check syslog forwarding
journalctl -u rsyslog --since "1 hour ago"
```

---

## 5. Incident Response

### 5.1 Log Sources
- Container logs: `journalctl --user -u airgap-rpm-publisher`
- Audit logs: `/var/log/audit/audit.log`
- HTTP access logs: `/var/log/rpmserver/httpd-access.log`
- Syslog: Forwarded to central server

### 5.2 Common Investigation Commands
```bash
# Search audit logs for authentication failures
ausearch -m USER_AUTH -sv no

# Check recent privileged command usage
ausearch -m EXECVE -k privileged

# Review file access
ausearch -k identity
```

---

## 6. Roles and Responsibilities

| Role | Responsibilities |
|------|-----------------|
| System Administrator | Container management, certificate rotation, patching |
| Security Administrator | STIG compliance, audit review, incident response |
| Auditor | Evidence collection, compliance verification |

---

## 7. References

- NIST SP 800-53 Rev. 5
- DISA RHEL 9 STIG
- FIPS 140-2/140-3
- CIS RHEL 9 Benchmark

---

## Appendix A: Control Family Summary

| Family | Controls Addressed |
|--------|-------------------|
| AC (Access Control) | AC-2, AC-3, AC-17 |
| AU (Audit and Accountability) | AU-2, AU-3, AU-6, AU-9 |
| CM (Configuration Management) | CM-2, CM-3, CM-6, CM-7 |
| IA (Identification and Authentication) | IA-2, IA-5 |
| SC (System and Communications Protection) | SC-8, SC-12, SC-13, SC-23 |
| SI (System and Information Integrity) | SI-2, SI-3, SI-7 |

---

## Appendix B: Syslog TLS Configuration Template

```conf
# /etc/rsyslog.d/60-tls-forward.conf
# Server-auth only (no client certificates)

global(
    DefaultNetstreamDriver="gtls"
    DefaultNetstreamDriverCAFile="/etc/pki/tls/certs/syslog-ca.crt"
)

*.* action(
    type="omfwd"
    target="<syslog_server>"
    port="6514"
    protocol="tcp"
    StreamDriver="gtls"
    StreamDriverMode="1"
    StreamDriverAuthMode="anon"
)
```
